# https://github.com/goharbor/harbor-helm/blob/main/values.yaml

expose:
  type: clusterIP
  tls:
    enabled: false
  clusterIP:
    name: harbor
    annotations: {}
    ports:
      httpPort: 80
      httpsPort: 443

externalURL: https://registry.toki317.dev

internalTLS:
  enabled: false

ipFamily:
  ipv6:
    enabled: true
  ipv4:
    enabled: true

persistence:
  enabled: true
  resourcePolicy: "keep"
  imageChartStorage:
    type: s3
    s3:
      # Set an existing secret for S3 accesskey and secretkey
      # keys in the secret should be REGISTRY_STORAGE_S3_ACCESSKEY and REGISTRY_STORAGE_S3_SECRETKEY for registry
      existingSecret: "storage"
      region: ap-osaka-1
      bucket: harbor
      regionendpoint: https://axekqehyne6j.compat.objectstorage.ap-osaka-1.oraclecloud.com

imagePullPolicy: Always

# The update strategy for deployments with persistent volumes(jobservice, registry): "RollingUpdate" or "Recreate"
# Set it as "Recreate" when "RWM" for volumes isn't supported
updateStrategy:
  type: RollingUpdate

# debug, info, warning, error or fatal
logLevel: info

existingSecretAdminPassword: "password"
existingSecretAdminPasswordKey: HARBOR_ADMIN_PASSWORD

existingSecretSecretKey: "secret-key"

# Run the migration job via helm hook
enableMigrateHelmHook: false

# If service exposed via "ingress", the Nginx will not be used
nginx:
  revisionHistoryLimit: 0
  nodeSelector:
    kubernetes.io/arch: amd64
  tolerations:
    - key: toki317.dev/role
      operator: Equal
      value: amd64-burstable
      effect: NoExecute

portal:
  revisionHistoryLimit: 0
  nodeSelector:
    kubernetes.io/arch: amd64
  tolerations:
    - key: toki317.dev/role
      operator: Equal
      value: amd64-burstable
      effect: NoExecute

core:
  revisionHistoryLimit: 0
  nodeSelector:
    kubernetes.io/arch: amd64
  tolerations:
    - key: toki317.dev/role
      operator: Equal
      value: amd64-burstable
      effect: NoExecute

jobservice:
  jobLoggers:
    - stdout
  revisionHistoryLimit: 0
  nodeSelector:
    kubernetes.io/arch: amd64
  tolerations:
    - key: toki317.dev/role
      operator: Equal
      value: amd64-burstable
      effect: NoExecute

registry:
  revisionHistoryLimit: 0
  nodeSelector:
    kubernetes.io/arch: amd64
  tolerations:
    - key: toki317.dev/role
      operator: Equal
      value: amd64-burstable
      effect: NoExecute
  credentials:
    username: "registry"
    password: "password"
    # If using existingSecret, the key must be REGISTRY_PASSWD and REGISTRY_HTPASSWD
    existingSecret: ""
    # NOTE: https://github.com/goharbor/harbor-helm/issues/1210
    # Login and password in htpasswd string format. Excludes `registry.credentials.username`  and `registry.credentials.password`. May come in handy when integrating with tools like argocd or flux. This allows the same line to be generated each time the template is rendered, instead of the `htpasswd` function from helm, which generates different lines each time because of the salt.
    htpasswdString: "$apr1$rh1m2juc$Uc80ybNOVBVTr2vl41aXe0"

trivy:
  enabled: true
  nodeSelector:
    kubernetes.io/arch: amd64
  tolerations:
    - key: toki317.dev/role
      operator: Equal
      value: amd64-burstable
      effect: NoExecute

database:
  type: internal
  internal:
    password: "password"
    shmSizeLimit: 128Mi
    livenessProbe:
      timeoutSeconds: 5
    readinessProbe:
      timeoutSeconds: 5
    nodeSelector:
      kubernetes.io/arch: amd64
    tolerations:
      - key: toki317.dev/role
        operator: Equal
        value: amd64-burstable
        effect: NoExecute

redis:
  type: internal
  internal:
    nodeSelector:
      kubernetes.io/arch: amd64
    tolerations:
      - key: toki317.dev/role
        operator: Equal
        value: amd64-burstable
        effect: NoExecute

exporter:
  revisionHistoryLimit: 0
  nodeSelector:
    kubernetes.io/arch: amd64
  tolerations:
    - key: toki317.dev/role
      operator: Equal
      value: amd64-burstable
      effect: NoExecute

metrics:
  enabled: false

trace:
  enabled: false
